- name: Docker run
  when: ETCD_NAME == inventory_hostname
  docker_container:
    name: "{{ CONTAINER_NAME }}"
    image: "{{ IMAGE }}:{{ IMAGE_TAG }}"
    pull: "no"
    recreate: "yes"
    command: etcd -name {{ ETCD_NAME }}
    env:
      ETCD_ENABLE_V2: 'true'
      ALLOW_NONE_AUTHENTICATION: 'yes'
      ETCD_LISTEN_PEER_URLS: http://0.0.0.0:2380
      ETCD_INITIAL_ADVERTISE_PEER_URLS: "{{ ETCD_URL }}:2380"
      ETCD_LISTEN_CLIENT_URLS: http://0.0.0.0:2379
      ETCD_ADVERTISE_CLIENT_URLS: "{{ ETCD_URL }}:2379"
      ETCD_INITIAL_CLUSTER: "{{ ETCD_INITIAL_CLUSTER }}"
      ETCD_INITIAL_CLUSTER_STATE: new
      ETCD_INITIAL_CLUSTER_TOKEN: "{{ ETCD_TOKEN }}"
    cpu_period: "{{ DOCKER_CPU_PERIOD }}"
    cpu_quota: "{{ DOCKER_CPU_QUOTA }}"
    memory: "{{ DOCKER_MEMORY }}"
    state: "{{ CONTAINER_STATE }}"   
    restart_policy: "unless-stopped"
    log_driver: "{{ DOCKER_LOG_DRIVER }}"
    log_options: "{{ DOCKER_LOG_OPTIONS }}"    
    ports:
    -  "{{ CLIENT_PORT }}:2380"
    -  "{{ PEER_PORT }}:2379"